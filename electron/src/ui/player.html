<!DOCTYPE html>
<html>
<head>
    <title>AnimeTV Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <style>
html, body{
  margin:0;
  padding:0;
  background-color: #000;
  overflow: hidden;
}
video-js, video{
  display: block !important;
  position: absolute !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  top:0 !important;
  width: 100vw !important;
  height: 100vh !important;
  overflow: hidden;
  background-color: #000;
}
video-js div *,
video-js div{
  display: none !important;
}
video{
  z-index: 99999 !important;
}
    </style>
    <script>window.HELP_IMPROVE_VIDEOJS = false;</script>
    <script src="/__ui/video.min.js"></script>
    <script src="/__ui/videojs-http-streaming.min.js"></script>
</head>
<body>
  <video-js id="player"></video-js>
<script>
(function(){
  videojs.Vhs.GOAL_BUFFER_LENGTH = 15;
  videojs.Vhs.MAX_GOAL_BUFFER_LENGTH = 20;
  var huri=location.search;
  if (huri.length>0){
    /* Send message to parent frame */
    function $p(c,d){
      var msg=JSON.stringify({
        vcmd:c,
        val:d
      });
      console.log("ATVLOG PostMessage "+msg);
      parent.postMessage(msg,'*');
    }

    /* Prepare stream data */
    var dash=(location.hash==="#dash");
    var uri=huri.substring(1);
    var player=document.getElementById('player');
    var vtype='application/x-mpegURL';
    if (dash){
      vtype='application/dash+xml';
    }

    /* Create player */
    var video=videojs('player',{
      fluid: true,
      controls: false,
      autoplay: true,
      preload: 'auto',
      responsive:true,
      sources: [{
        src: uri,
        type:vtype
      }]
    });

    /* Set event listener */
    video.on('ready', function() {
      console.log('Ready');
    });
    video.on('play', function() {
      console.log('Play');
    });
    video.on('pause', function() {
      console.log('Pause');
    });
    video.on('timeupdate', function() {
      console.log('timeupdate: '+video.currentTime()+' / '+video.duration());
      $p('time',{
        position:video.currentTime(),
        duration:video.duration()
      });
    });
    video.on('ended', function() {
      // this.dispose();
      console.log('Ended');
    });

    /* Command Receiver */
    function commandReceiver(c,v){
      if (c=='play'){
        video.play();
      }
      else if (c=='pause'){
        video.pause();
      }
      else if (c=='seek'){
        video.seek(v);
      }
      else if (c=='speed'){
        try{
          video.setPlaybackRate(v);
        }catch(e){}
      }
      else if (c=='scale'){
        try{
            document.firstElementChild.className='scale-'+v;
        }catch(e){}
      }
      else if (c=='ready'){
        /*jwburstquality();*/
      }
    }
    /* register message handler */
    window.addEventListener('message',function(e) {
      try{
        var j=JSON.parse(e.data);
        if ('vcmd' in j){
          commandReceiver(j.vcmd,j.val);
        }
      }catch(e){}
    });

    /* Play */
    video._player=player;
    window._vid=video;
  }
})();
</script>
</body>
</html>